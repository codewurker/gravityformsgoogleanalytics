!function(r){function g(a){r(".gforms_note_error").remove(),r("#gform-page-loader-mask").hide(),r("#gform-settings").before('<div class="alert gforms_note_error" role="alert">'+a+"</div>"),r(".alert").get(0).scrollIntoView()}function l(){r(".gforms_note_error").remove()}jQuery(document).ready(function(){let d=r("#gform-settings"),e=r(".gfga-disconnect"),s=(0<e.length&&e.on("click",function(a){a.preventDefault(),e.html(google_analytics_admin_strings.disconnect);a=wpAjax.unserialize(a.target.href).nonce;r.post(ajaxurl,{action:"disconnect_account",nonce:a},function(a){window.location.href=window.location.href})}),d.find('input[name="gfgaaction"]'));0!==s.length&&"manual"!==s.val()&&d.find(":submit").prop("disabled",!0),r("#gform-settings-section-google-analytics-settings").on("change","input, select",function(a){var e=d.find('select[name="gaproperty"]').find(":selected").val(),t=r("#ga-data-streams select :selected").val();let n=d.find('select[name="gtmproperty"]').find(":selected").val(),o=(n=n||d.find("#container").val(),d.find('select[name="gaworkspace"]').val());o=o||d.find("#workspace").val();var i=d.find(":submit");"ga"===s.val()&&(e&&t?i.prop("disabled",!1):i.prop("disabled",!0)),"gtm"===s.val()&&(n&&o?i.prop("disabled",!1):i.prop("disabled",!0))}),d.on("submit",function(a){var e,t,n,o,i,s,c;l(),1===d.find('input[value="google_analytics_setup"]').length?(a.preventDefault(),e=d.find("#gform-settings-save"),t=d.find('[name="_gform_setting_mode"]:checked').val(),e.prop("value",google_analytics_admin_strings.redirect).prop("disabled","disabled"),e=d.find('input[name="gfganonce"]').val(),r.post(ajaxurl,{action:"redirect_to_api",nonce:e,mode:t},function(a){a.data.errors||(window.location.href=a.data.redirect)},"json")):0!==(e=d.find('input[name="gfgaaction"]')).length&&("ga"===e.val()&&(a.preventDefault(),t=d.find('select[name="gaproperty"]').find(":selected"),n=d.find("#ga-data-streams select :selected"),r.post(ajaxurl,{action:"save_google_analytics_data",account_id:t.data("account-id"),account_name:t.data("account-name"),property_id:t.val(),property_name:t.data("property-name"),measurement_id:n.val(),data_stream_name:n.data("data-stream-name"),data_stream_id:n.data("data-stream-id"),nonce:d.find('input[name="gfganonce"]').val(),token:d.find('input[name="gfga_token"]').val(),refresh:d.find('input[name="gfga_refresh"]').val()},function(a){a.success?window.location.href=a.data:g(a.data[0].message)})),"gtm"===e.val()&&(a.preventDefault(),t=d.find('select[name="gaproperty"]').find(":selected"),n=d.find("#ga-data-streams select :selected"),o=d.find('select[name="gtmproperty"] :selected'),i=d.find('select[name="gacontainer"] :selected'),s=d.find('select[name="gaworkspace"] :selected'),c=d.find('input[name="_gform_setting_gtm_auto_create"]'),r.post(ajaxurl,{action:"save_google_tag_manager_data",account_id:t.data("account-id"),account_name:t.data("account-name"),property_id:t.val(),property_name:t.data("property-name"),measurement_id:n.val(),data_stream_name:n.data("data-stream-name"),gtm_account_id:o.data("account-id"),gtm_account_name:o.val(),gtm_api_path:i.data("path"),gtm_container:i.val(),gtm_auto_create:c.val(),gtm_workspace_id:s.val(),gtm_workspace_name:s.text(),nonce:d.find('input[name="gfganonce"]').val(),token:d.find('input[name="gfga_token"]').val(),refresh:d.find('input[name="gfga_refresh"]').val()},function(a){!1===a.success?g(a.data[0].message):window.location.href=a.data})),"manual"===e.val())&&(a.preventDefault(),r.post(ajaxurl,{action:"save_manual_configuration_data",mode:d.find("#ga_connection_type").val(),measurement_id:d.find("#ga_measurement_id").val(),gmp_api_secret:d.find("#gmp_api_secret").val(),gtm_container:d.find("#gtm_container_id").val(),gtm_workspace_id:d.find("#gtm_workspace_id").val(),nonce:d.find('input[name="gfganonce"]').val()},function(a){!1===a.success?g(a.data[0].message):window.location.href=a.data}))}),r("#gaproperty").on("change",function(a){l();var e=r(this).find(":selected"),t=r("body").find('input[name="gfganonce"]').val(),n=d.find('input[name="gfga_token"]').val();r("#ga-data-streams").html('<br /><img src="'+google_analytics_admin_strings.spinner+'" />'),r.post(ajaxurl,{action:"get_ga4_data_streams",account:e.data("account-id"),property:e.val(),nonce:t,token:n},function(a){a.success?r("#ga-data-streams").html(a.data):(r("#ga-data-streams").html(""),g(a.data[0].message))})}),r("#gtmproperty").on("change",function(a){l();var e=r(this).find(":selected"),t=e.data("accountId"),n=e.data("path"),e=e.data("token"),o=r("body").find('input[name="gfganonce"]').val();r("#gtm-containers").html('<br /><img src="'+google_analytics_admin_strings.spinner+'" />'),r("#gtm-workspaces").html(""),r.post(ajaxurl,{action:"get_gtm_containers",accountId:t,path:n,nonce:o,token:e},function(a){a.success?r("#gtm-containers").html(a.body):(g(a.data[0].message),r("#gtm-containers").html(""))})}),r(document).on("change","#gacontainer",function(a){l();var e=r(this).find(":selected"),t=e.data("path"),e=e.data("token"),n=r("body").find('input[name="gfganonce"]').val();r("#gtm-workspaces").html('<br /><img src="'+google_analytics_admin_strings.spinner+'" />'),r.post(ajaxurl,{action:"get_gtm_workspaces",path:t,nonce:n,token:e},function(a){a.success?r("#gtm-workspaces").html(a.body):(g(a.data[0].message),r("#gform_setting_workspace").show(),r("#gtm-workspaces").html(""))})})})}((window.GF_Google_Analytics_Admin=window.GF_Google_Analytics_Admin||{},jQuery));